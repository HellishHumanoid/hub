local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Rafso Car Zone",
    LoadingTitle = "Crazy",
    LoadingSubtitle = "by Rafso",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = nil,
        FileName = "AutoRace"
    },
    Discord = {
        Enabled = false
    },
    KeySystem = false
})

local MainTab = Window:CreateTab("Main", 4483362458)
local ESPTab = Window:CreateTab("ESP", 4483362458)

-- Variables
local autoRaceEnabled = false
local autoPresentEnabled = false
local espEnabled = false
local player = game.Players.LocalPlayer
local espObjects = {}

-- ==================== ANTI-AFK SYSTEM ====================
local antiAFKRunning = false

local function startAntiAFK()
    if antiAFKRunning then return end
    antiAFKRunning = true
    
    task.spawn(function()
        local VIM = game:GetService("VirtualInputManager")
        
        while antiAFKRunning do
            -- Wait 5 minutes (300 seconds)
            task.wait(300)
            
            -- Send a mouse click
            VIM:SendMouseButtonEvent(0, 0, 0, true, game, 1)
            task.wait(0.1)
            VIM:SendMouseButtonEvent(0, 0, 0, false, game, 1)
            
            print("Anti-AFK: Click sent")
        end
    end)
    
    print("Anti-AFK: Started - Clicking every 5 minutes")
end

local function stopAntiAFK()
    antiAFKRunning = false
    print("Anti-AFK: Stopped")
end

-- Start Anti-AFK automatically when script loads
startAntiAFK()

-- ==================== ESP CONFIGURATION ====================

-- ESP Configuration
local ESP_CONFIG = {
    Normal = {
        BoxColor = Color3.fromRGB(255, 0, 0), -- Red
        TextColor = Color3.fromRGB(255, 100, 100), -- Brighter Red
        Name = "Present"
    },
    Golden = {
        BoxColor = Color3.fromRGB(255, 215, 0), -- Yellow/Gold
        TextColor = Color3.fromRGB(255, 255, 100), -- Brighter Yellow
        Name = "Golden Present"
    }
}

-- Function to create ESP for a single present
local function createESP(presentModel, isGolden)
    if espObjects[presentModel] then return end
    
    local config = isGolden and ESP_CONFIG.Golden or ESP_CONFIG.Normal
    
    -- Create a BillboardGui
    local billboardGui = Instance.new("BillboardGui")
    billboardGui.Name = "PresentESP"
    billboardGui.AlwaysOnTop = true
    billboardGui.Size = UDim2.new(0, 200, 0, 50)
    billboardGui.StudsOffset = Vector3.new(0, 3, 0)
    billboardGui.Adornee = presentModel.PrimaryPart or presentModel:FindFirstChildWhichIsA("BasePart")
    
    if not billboardGui.Adornee then
        billboardGui:Destroy()
        return
    end
    
    -- Create text label
    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(1, 0, 1, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.Text = config.Name
    textLabel.TextColor3 = config.TextColor
    textLabel.TextSize = 34
    textLabel.Font = Enum.Font.GothamBold
    textLabel.TextStrokeTransparency = 0.5
    textLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
    textLabel.Parent = billboardGui
    
    -- Apply custom font properties (Gotham SemiBold Italic)
    local fontFace = Font.new(
        "rbxasset://fonts/families/GothamSSm.json",
        Enum.FontWeight.SemiBold,
        Enum.FontStyle.Italic
    )
    textLabel.FontFace = fontFace
    
    billboardGui.Parent = game.CoreGui
    
    -- Create highlight
    local highlight = Instance.new("Highlight")
    highlight.Name = "PresentHighlight"
    highlight.FillColor = config.BoxColor
    highlight.FillTransparency = 0.5
    highlight.OutlineColor = config.BoxColor
    highlight.OutlineTransparency = 0
    highlight.Adornee = presentModel
    highlight.Parent = game.CoreGui
    
    -- Store ESP objects
    espObjects[presentModel] = {
        Billboard = billboardGui,
        Highlight = highlight
    }
end

-- Function to remove ESP from a present
local function removeESP(presentModel)
    if espObjects[presentModel] then
        if espObjects[presentModel].Billboard then
            espObjects[presentModel].Billboard:Destroy()
        end
        if espObjects[presentModel].Highlight then
            espObjects[presentModel].Highlight:Destroy()
        end
        espObjects[presentModel] = nil
    end
end

-- Function to clear all ESP
local function clearAllESP()
    for presentModel, espData in pairs(espObjects) do
        if espData.Billboard then
            espData.Billboard:Destroy()
        end
        if espData.Highlight then
            espData.Highlight:Destroy()
        end
    end
    espObjects = {}
end

-- Function to update ESP for all presents
local function updateESP()
    if not espEnabled then
        clearAllESP()
        return
    end
    
    -- Get folders
    local pumpkinsFolder = workspace:FindFirstChild("Pumpkins")
    local goldenPumpkinsFolder = workspace:FindFirstChild("PumpkinsGolden")
    
    -- Track which presents still exist
    local existingPresents = {}
    
    -- Process normal pumpkins
    if pumpkinsFolder then
        for _, model in pairs(pumpkinsFolder:GetChildren()) do
            if model:IsA("Model") then
                existingPresents[model] = true
                if not espObjects[model] then
                    createESP(model, false)
                end
            end
        end
    end
    
    -- Process golden pumpkins
    if goldenPumpkinsFolder then
        for _, model in pairs(goldenPumpkinsFolder:GetChildren()) do
            if model:IsA("Model") then
                existingPresents[model] = true
                if not espObjects[model] then
                    createESP(model, true)
                end
            end
        end
    end
    
    -- Remove ESP for presents that no longer exist
    for presentModel, _ in pairs(espObjects) do
        if not existingPresents[presentModel] then
            removeESP(presentModel)
        end
    end
end

-- ESP Update Loop
spawn(function()
    while true do
        if espEnabled then
            updateESP()
        end
        wait(0.5) -- Update every 0.5 seconds
    end
end)

-- Listen for new presents being added
local function setupFolderListener(folder, isGolden)
    if not folder then return end
    
    folder.ChildAdded:Connect(function(child)
        if espEnabled and child:IsA("Model") then
            wait(0.1) -- Small delay to ensure model is fully loaded
            createESP(child, isGolden)
        end
    end)
    
    folder.ChildRemoved:Connect(function(child)
        if child:IsA("Model") then
            removeESP(child)
        end
    end)
end

-- Setup listeners
local pumpkinsFolder = workspace:FindFirstChild("Pumpkins")
local goldenPumpkinsFolder = workspace:FindFirstChild("PumpkinsGolden")

if pumpkinsFolder then
    setupFolderListener(pumpkinsFolder, false)
end

if goldenPumpkinsFolder then
    setupFolderListener(goldenPumpkinsFolder, true)
end

-- Watch for folders being added if they don't exist yet
workspace.ChildAdded:Connect(function(child)
    if child.Name == "Pumpkins" then
        setupFolderListener(child, false)
    elseif child.Name == "PumpkinsGolden" then
        setupFolderListener(child, true)
    end
end)

-- Create ESP Toggle
local ESPToggle = ESPTab:CreateToggle({
    Name = "Present ESP",
    CurrentValue = false,
    Flag = "PresentESPToggle",
    Callback = function(Value)
        espEnabled = Value
        
        if Value then
            print("Present ESP enabled!")
            updateESP()
        else
            print("Present ESP disabled!")
            clearAllESP()
        end
    end,
})

-- Function to get the vehicle the player is sitting in
local function getVehicle()
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if humanoid and humanoid.SeatPart then
        local seat = humanoid.SeatPart
        return seat.Parent
    end
    return nil
end

-- Function to teleport vehicle to a position
local function teleportVehicleToCheckpoint(checkpointPosition)
    local vehicle = getVehicle()
    
    if not vehicle then
        warn("You are not in a vehicle!")
        return false
    end
    
    local vehicleRoot = vehicle.PrimaryPart or vehicle:FindFirstChild("VehicleSeat") or vehicle:FindFirstChildWhichIsA("VehicleSeat")
    
    if not vehicleRoot then
        warn("Could not find vehicle's primary part!")
        return false
    end
    
    -- Anchor all parts
    local partsToUnanchor = {}
    for _, part in pairs(vehicle:GetDescendants()) do
        if part:IsA("BasePart") and not part.Anchored then
            part.Anchored = true
            table.insert(partsToUnanchor, part)
            -- Reset velocity
            part.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
            part.AssemblyAngularVelocity = Vector3.new(0, 0, 0)
        end
    end
    
    -- Teleport
    local currentCFrame = vehicleRoot.CFrame
    local offset = currentCFrame - currentCFrame.Position
    vehicle:SetPrimaryPartCFrame(CFrame.new(checkpointPosition) * offset)
    
    -- Wait a moment then unanchor
    wait(0.05)
    for _, part in pairs(partsToUnanchor) do
        part.Anchored = false
    end
    
    return true
end

-- Auto-Race function
local function startAutoRace()
    local checkpointsFolder = workspace:FindFirstChild("Around The World")
    if not checkpointsFolder then
        warn("Could not find 'Around The World' folder!")
        return
    end
    
    checkpointsFolder = checkpointsFolder:FindFirstChild("Checkpoints")
    if not checkpointsFolder then
        warn("Could not find 'Checkpoints' folder!")
        return
    end
    
    -- Get all checkpoints and sort them
    local checkpoints = {}
    for _, checkpoint in pairs(checkpointsFolder:GetChildren()) do
        if checkpoint.Name:match("Checkpoint%d+") then
            local number = tonumber(checkpoint.Name:match("%d+"))
            if number then
                checkpoints[number] = checkpoint
            end
        end
    end
    
    -- Start the auto-race loop
    while autoRaceEnabled do
        -- Step 4: Teleport to starting position
        print("Teleporting to starting position...")
        teleportVehicleToCheckpoint(Vector3.new(-1131, 2, -4203))
        
        if not autoRaceEnabled then break end
        
        -- Step 5: Wait 10 seconds
        print("Waiting 10 seconds...")
        wait(10)
        
        if not autoRaceEnabled then break end
        
        -- Step 6: Wait 15 seconds
        print("Waiting 15 seconds...")
        wait(15)
        
        if not autoRaceEnabled then break end
        
        -- Steps 1 & 2: Go through checkpoints twice
        for lap = 1, 2 do
            if not autoRaceEnabled then break end
            
            print("Starting lap " .. lap .. " of 2")
            
            for i = 1, #checkpoints do
                if not autoRaceEnabled then
                    break
                end
                
                local checkpoint = checkpoints[i]
                if checkpoint and checkpoint:IsA("BasePart") then
                    print("Lap " .. lap .. " - Teleporting to Checkpoint " .. i)
                    teleportVehicleToCheckpoint(checkpoint.Position)
                    wait(3) -- 3 second delay
                elseif checkpoint and checkpoint:IsA("Model") then
                    -- If checkpoint is a model, use its PrimaryPart or first part
                    local checkpointPart = checkpoint.PrimaryPart or checkpoint:FindFirstChildWhichIsA("BasePart")
                    if checkpointPart then
                        print("Lap " .. lap .. " - Teleporting to Checkpoint " .. i)
                        teleportVehicleToCheckpoint(checkpointPart.Position)
                        wait(2)
                    end
                end
            end
        end
        
        if autoRaceEnabled then
            -- Step 3: Wait 3 seconds after completing both laps
            print("Both laps complete! Waiting 3 seconds...")
            wait(3)
            
            print("Restarting cycle...")
        end
    end
end

-- Create the Auto-Race toggle
local AutoRaceToggle = MainTab:CreateToggle({
    Name = "Auto-Race [Around The World]",
    CurrentValue = false,
    Flag = "AutoRaceToggle",
    Callback = function(Value)
        autoRaceEnabled = Value
        
        if Value then
            print("Auto-Race enabled!")
            spawn(function()
                startAutoRace()
            end)
        else
            print("Auto-Race disabled!")
        end
    end,
})

MainTab:CreateLabel("Get in your car first.")

-- Present spawn locations
local presentLocations = {
    Vector3.new(-2078, 150, -4495),
    Vector3.new(-1888, 150, -3480),
    Vector3.new(-1054, 150, -4671),
    Vector3.new(-1143, 150, -3068),
    Vector3.new(-205, 150, -4506),
    Vector3.new(1145, 150, -4357),
    Vector3.new(22, 150, -3487),
    Vector3.new(-1025, 150, -2568),
    Vector3.new(417, 150, -2308),
    Vector3.new(-1078, 150, -1307),
    Vector3.new(-523, 150, -574),
    Vector3.new(713, 150, -562),
    Vector3.new(1346, 150, -1452),
    Vector3.new(1636, 150, -3026),
    Vector3.new(2560, 150, -3963),
    Vector3.new(2283, 150, -2892),
    Vector3.new(2055, 150, -1642),
    Vector3.new(2069, 150, -488),
    Vector3.new(3840, 150, -1101),
    Vector3.new(4045, 150, -2016),
    Vector3.new(2810, 150, -2333),
    Vector3.new(3989, 150, -2851),
    Vector3.new(3502, 150, -3850),
    Vector3.new(4344, 150, -4923),
    Vector3.new(2916, 150, -5053),
    Vector3.new(-1028, 150, -503),
    Vector3.new(2398, 150, 2112),
    Vector3.new(5949, 150, 2772),
    Vector3.new(3530, 150, 37),
    Vector3.new(2942, 150, -1515),
    Vector3.new(-1180, 150, -3275)
}

-- Function to teleport player character
local function teleportPlayer(position)
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
    
    -- Reset velocity
    humanoidRootPart.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
    humanoidRootPart.AssemblyAngularVelocity = Vector3.new(0, 0, 0)
    
    -- Teleport
    humanoidRootPart.CFrame = CFrame.new(position)
end

-- Function to freeze player
local function freezePlayer(freeze)
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
    
    humanoidRootPart.Anchored = freeze
end

-- Function to get all current presents
local function getAllPresents()
    local presents = {}
    
    local pumpkinsFolder = workspace:FindFirstChild("Pumpkins")
    local goldenPumpkinsFolder = workspace:FindFirstChild("PumpkinsGolden")
    
    -- Get all normal pumpkins
    if pumpkinsFolder then
        for _, model in pairs(pumpkinsFolder:GetChildren()) do
            if model:IsA("Model") then
                table.insert(presents, model)
            end
        end
    end
    
    -- Get all golden pumpkins
    if goldenPumpkinsFolder then
        for _, model in pairs(goldenPumpkinsFolder:GetChildren()) do
            if model:IsA("Model") then
                table.insert(presents, model)
            end
        end
    end
    
    return presents
end

-- FIXED Auto-Present function - UNFREEZES TO COLLECT!
local function startAutoPresent()
    local collectedPresents = {} -- Track collected presents to avoid duplicates
    
    while autoPresentEnabled do
        print("=== Starting new cycle ===")
        
        -- Go through each spawn location
        for i, location in ipairs(presentLocations) do
            if not autoPresentEnabled then 
                freezePlayer(false)
                print("Auto-Present stopped by user")
                return 
            end
            
            print("Checking location " .. i .. " of " .. #presentLocations)
            
            -- Teleport to the spawn location
            teleportPlayer(location)
            
            -- Freeze player in the air
            freezePlayer(true)
            
            -- Wait 2 seconds while frozen to allow presents to load
            wait(2)
            
            -- Get all presents
            local allPresents = getAllPresents()
            
            -- Find uncollected presents within 300 studs
            local nearbyPresents = {}
            for _, present in pairs(allPresents) do
                if not collectedPresents[present] then
                    local presentPart = present.PrimaryPart or present:FindFirstChildWhichIsA("BasePart")
                    if presentPart then
                        local distance = (presentPart.Position - location).Magnitude
                        if distance <= 3000 then
                            table.insert(nearbyPresents, present)
                        end
                    end
                end
            end
            
            -- UNFREEZE before collecting!
            freezePlayer(false)
            
            if #nearbyPresents > 0 then
                print("Found " .. #nearbyPresents .. " presents near location " .. i .. "! Collecting...")
                
                -- Collect each present
                for _, present in pairs(nearbyPresents) do
                    if not autoPresentEnabled then 
                        return 
                    end
                    
                    local presentPart = present.PrimaryPart or present:FindFirstChildWhichIsA("BasePart")
                    if presentPart then
                        print("Teleporting to collect present: " .. present.Name)
                        teleportPlayer(presentPart.Position)
                        collectedPresents[present] = true
                        wait(0.5) -- Wait for collection
                    end
                end
                
                print("Finished collecting presents at location " .. i)
            else
                print("No presents near location " .. i)
            end
            
            wait(0.2) -- Small delay before next location
        end
        
        print("=== Completed all " .. #presentLocations .. " locations! ===")
        print("Clearing collected presents list and restarting cycle in 1 second...")
        collectedPresents = {} -- Reset collected list for next cycle
        wait(1)
    end
    
    -- Make sure player is unfrozen when function ends
    freezePlayer(false)
    print("Auto-Present fully stopped")
end

-- Create the Auto-Present toggle
local AutoPresentToggle = MainTab:CreateToggle({
    Name = "Auto-Present",
    CurrentValue = false,
    Flag = "AutoPresentToggle",
    Callback = function(Value)
        autoPresentEnabled = Value
        
        if Value then
            print("Auto-Present enabled!")
            spawn(function()
                startAutoPresent()
            end)
        else
            print("Auto-Present disabled!")
        end
    end,
})

Rayfield:LoadConfiguration()
